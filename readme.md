# Проект для кубка РТК
Пожелания, жалобы, конструктивная критика и тому подобное принимается в [вк](https://vk.com/al_kom_ru).
## Задействованная переферия
Проект задействует следующую перефирию:
+ DMA1 и TIM3 для работы адресными светодиодами;
+ TIM4 для реализации функций задержек;
+ PA10,PA11,PA12,PA15,PB3,PB4 для работы с LCD дисплеем;
+ SPI2 и PA9 для работы с динамиком;
+ PA1 для тактовой кнопки.

## Тактирование проекта
Проект настроен на работую частоту 72МГц при внешнем кварце на 12 Мгц. В случае если будет использоваться внешний кварц не равный 12МГц, то нужно изменить настройки тактирования:
1. В файле system_stm32f10x.c нужно изменить множитель для PLL. Находится необходимый множитель в строке №1056.

   ![Фото1](https://github.com/KomarovAlexandr/Photo_repository/blob/master/CupRTC/1.png?raw=true)
   
2. Также для надежности (так действительно надо) в настройках самого проекта прописана частота внешнего источника. Если это значение не поменять, то часть перефирии будет думать, что частота одна, а другая часть, что другая.

   ![Фото2](https://github.com/KomarovAlexandr/Photo_repository/blob/master/CupRTC/2.png?raw=true)
  
## Подготовка массива для воспроизведения на динамике
Допустим в начале мы имеем какую то аудяшку, а в итоге нам необходимо получить массив в файле voice.h. Как сделать?

Вот тяк:
1. Для начала переведем его в нужный формат. Я для этого использую программку [jetAudio](http://www.jetaudio.com/download/). Открываем прогу, отображаем содержимое компа (1), находим нашу аудио и нажимаем пару раз (2), далее внизу нажимаем кнопку конверта (3).

  ![Фото3](https://github.com/KomarovAlexandr/Photo_repository/blob/master/CupRTC/3.png?raw=true)

2. Далее добавляем нашу аудио в список (1), задаем имя (2), выбираем необходимый формат (3), настраиваем формат (4 и 5), и нажимаем кнопку старт(6).

  ![Фото4](https://github.com/KomarovAlexandr/Photo_repository/blob/master/CupRTC/4.png?raw=true)
  
3. Далее необходимо отрубить заголовок нашему файлу. Важно не промахнутсья. В интернете пишут, что заголовок занимает 192 байта, то есть 12 строк. Однако, мной выяснено, что это не всегда так. В моих файлах заголовок занимает 160 байт. Итак, открываем файл в hex-редакторе, я использую HexEditorNeo. В тех файлах, что редактировал я, начиная со 152го байта идет слово "data", далее 4 байта, характеризующие размер данных и СРАЗУ после этого начинаются данные. Соответсвенно, удаляем первые 160 байт (10 строк) и сохраняем файл.
  
  ![Фото5](https://github.com/KomarovAlexandr/Photo_repository/blob/master/CupRTC/5.png?raw=true)
  
4. Далее изменяем формат нашего файла с audio.wav на audio.raw
5. После нужно превратить наш файл в voice.h. Для этого в корне проекта есть файл bin2h.exe. Открываем консоль и прописываем следующую команду:

 ![Фото6](https://github.com/KomarovAlexandr/Photo_repository/blob/master/CupRTC/6.png?raw=true)
 
 После этого на рабочем столе появляется файл voice.h, который уже можно или подключать или забирать из него массив в проект.
  
  
